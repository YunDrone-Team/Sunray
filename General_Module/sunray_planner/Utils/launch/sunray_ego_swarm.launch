<launch>
    <arg name="uav_num" default="3"/>
    <arg name="offset_dis" default="1.0"/>

    <!-- ego地图大小 -->
    <arg name="map_size_x" value="50.0"/>
    <arg name="map_size_y" value="50.0"/>
    <arg name="map_size_z" value=" 2"/>

    <!--  ego的输出指令 -->
    <arg name="cmd_sub_topic_1" default="/uav1/pos_cmd"/>
    <arg name="cmd_sub_topic_2" default="/uav2/pos_cmd"/>
    <arg name="cmd_sub_topic_3" default="/uav3/pos_cmd"/>

    <!-- 对应的sunray控制指令 -->
    <arg name="control_pub_topic_1" default="/uav1/sunray/uav_control_cmd"/>
    <arg name="control_pub_topic_2" default="/uav2/sunray/uav_control_cmd"/>
    <arg name="control_pub_topic_3" default="/uav3/sunray/uav_control_cmd"/>

    <!-- 局部坐标系下的点云话题 -->
    <arg name="local_pointcloud_topic_1" default="/uav1/livox"/>
    <arg name="local_pointcloud_topic_2" default="/uav2/livox"/>
    <arg name="local_pointcloud_topic_3" default="/uav3/livox"/>

    <!-- 转换出来的世界坐标系下的点云话题 -->
    <arg name="world_pointcloud_topic_1" default="/uav1/livox_world"/>
    <arg name="world_pointcloud_topic_2" default="/uav2/livox_world"/>
    <arg name="world_pointcloud_topic_3" default="/uav3/livox_world"/>

    <arg name="world_frame" default="world"/>

    <!-- 局部坐标系下的点云的frame_id -->
    <arg name="child_frame_1" default="uav1/livox_laser"/>
    <arg name="child_frame_2" default="uav2/livox_laser"/>
    <arg name="child_frame_3" default="uav3/livox_laser"/>

    <!-- 世界坐标系下的odom 用于给点云转换提供坐标 -->
    <arg name="odom_topic_1" default="/uav1/sunray/gazebo_pose"/>
    <arg name="odom_topic_2" default="/uav2/sunray/gazebo_pose"/>
    <arg name="odom_topic_3" default="/uav3/sunray/gazebo_pose"/>
\
    
        <!--  move_base_simple/goal转为三个平行的目标点 输出话题前缀  -->
    <arg name="goal_topic" default="/goal"/>
    <!--  三个平行的目标点 供ego中的每个飞机指明目标点 -->
    <arg name="goal_tipic_1" default="/goal_1"/>
    <arg name="goal_tipic_2" default="/goal_2"/>
    <arg name="goal_tipic_3" default="/goal_3"/>

    <!-- ego 输出转换为sunray控制指令 -->
    <node name="ego2sunray_node_1" pkg="sunray_planner_utils" type="ego2sunray" output="screen">
        <param name="cmd_sub_topic" value="$(arg cmd_sub_topic_1)"/>
        <param name="control_pub_topic" value="$(arg control_pub_topic_1)"/>
    </node>

    <node name="ego2sunray_node_2" pkg="sunray_planner_utils" type="ego2sunray" output="screen">
        <param name="cmd_sub_topic" value="$(arg cmd_sub_topic_2)"/>
        <param name="control_pub_topic" value="$(arg control_pub_topic_2)"/>
    </node>

    <node name="ego2sunray_node_3" pkg="sunray_planner_utils" type="ego2sunray" output="screen">
        <param name="cmd_sub_topic" value="$(arg cmd_sub_topic_3)"/>
        <param name="control_pub_topic" value="$(arg control_pub_topic_3)"/>
    </node>

    <!-- 点云转换为世界坐标系 -->
    <node name="point_cloud_transform_1" pkg="sunray_planner_utils" type="point_cloud_transform" output="screen">
        <param name="input_point_topic" value="$(arg local_pointcloud_topic_1)" />
        <param name="output_point_topic" value="$(arg world_pointcloud_topic_1)" />
        <param name="odom_topic" value="$(arg odom_topic_1)" />
        <param name="frame_id" value="$(arg world_frame)" />
        <param name="child_frame_id" value="$(arg child_frame_1)" />
    </node>

    <node name="point_cloud_transform_2" pkg="sunray_planner_utils" type="point_cloud_transform" output="screen">
        <param name="input_point_topic" value="$(arg local_pointcloud_topic_2)" />
        <param name="output_point_topic" value="$(arg world_pointcloud_topic_2)" />
        <param name="odom_topic" value="$(arg odom_topic_2)" />
        <param name="frame_id" value="$(arg world_frame)" />
        <param name="child_frame_id" value="$(arg child_frame_2)" />
    </node>

    <node name="point_cloud_transform_3" pkg="sunray_planner_utils" type="point_cloud_transform" output="screen">
        <param name="input_point_topic" value="$(arg local_pointcloud_topic_3)" />
        <param name="output_point_topic" value="$(arg world_pointcloud_topic_3)" />
        <param name="odom_topic" value="$(arg odom_topic_3)" />
        <param name="frame_id" value="$(arg world_frame)" />
        <param name="child_frame_id" value="$(arg child_frame_3)" />
    </node>

    <!-- 监听move_base_simple/goal (rviz中的2D Nav Goal) 将其转为多个平行的目标点发送到ego中的每个规划器-->
    <node name="goal2swarm" pkg="sunray_planner_utils" type="goal2swarm" output="screen">
        <param name="uav_num" value="$(arg uav_num)" />
        <param name="offset" value="$(arg offset_dis)" />
        <param name="goal_topic" value="goal" />
    </node>

    <!-- ego-planenr-swarm -->
    <include file="$(find ego_planner)/launch_sunray/run_in_swarm.launch">
        <arg name="drone_id" value="1"/>

        <arg name="init_x" value="-20.0"/>
        <arg name="init_y" value="-9.0"/>
        <arg name="init_z" value="0.1"/>

        <arg name="target_x" value="20.0"/>
        <arg name="target_y" value="9.0"/>
        <arg name="target_z" value="1"/>

        <arg name="map_size_x" value="$(arg map_size_x)"/>
        <arg name="map_size_y" value="$(arg map_size_y)"/>
        <arg name="map_size_z" value="$(arg map_size_z)"/>
        <arg name="odom_topic" value="$(arg odom_topic_1)"/>
        <arg name="cloudpoint2_topic" value="$(arg world_pointcloud_topic_1)"/>

        <arg name="goal_name_" value="$(arg goal_tipic_1)"/>
    </include>

    <include file="$(find ego_planner)/launch_sunray/run_in_swarm.launch">
        <arg name="drone_id" value="2"/>

        <arg name="init_x" value="-20.0"/>
        <arg name="init_y" value="-7.0"/>
        <arg name="init_z" value="0.1"/>

        <arg name="target_x" value="20.0"/>
        <arg name="target_y" value="7.0"/>
        <arg name="target_z" value="1"/>

        <arg name="map_size_x" value="$(arg map_size_x)"/>
        <arg name="map_size_y" value="$(arg map_size_y)"/>
        <arg name="map_size_z" value="$(arg map_size_z)"/>
        <arg name="odom_topic" value="$(arg odom_topic_2)"/>
        <arg name="cloudpoint2_topic" value="$(arg world_pointcloud_topic_2)"/>

        <arg name="goal_name_" value="$(arg goal_tipic_2)"/>
    </include>

    <include file="$(find ego_planner)/launch_sunray/run_in_swarm.launch">
        <arg name="drone_id" value="3"/>

        <arg name="init_x" value="-20.0"/>
        <arg name="init_y" value="-5.0"/>
        <arg name="init_z" value="0.1"/>

        <arg name="target_x" value="20.0"/>
        <arg name="target_y" value="5.0"/>
        <arg name="target_z" value="1"/>

        <arg name="map_size_x" value="$(arg map_size_x)"/>
        <arg name="map_size_y" value="$(arg map_size_y)"/>
        <arg name="map_size_z" value="$(arg map_size_z)"/>
        <arg name="odom_topic" value="$(arg odom_topic_3)"/>
        <arg name="cloudpoint2_topic" value="$(arg world_pointcloud_topic_3)"/>

        <arg name="goal_name_" value="$(arg goal_tipic_3)"/>
    </include>



</launch>
